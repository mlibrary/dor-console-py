{% extends "base.html" %}
{% set page_name = 'objects' %}
{% set page_title = 'Objects' %}

{% block content %}

<div class="flex-layout">
{% include '/partials/_side-nav.html' %}
<div class="main-content">
  <h1 class="title"> {{ page_title }}</h1>
  <p class="mb-2">View a list of the content objects. Click into an object's title to see more details about its contents.</p>

  <form action="" method="get">
    <h3 class="subtle-heading">Filter by</h3>
    <div class="input-group-inline">
      <div class="input-container">
        <label class="select-label" for="type-select">Type</label>
          <select id="type-select" class="select" name="object_type">
            <option value="">Select Type</option>
            {% for object_type in object_types %}
            <option value="{{ object_type }}">{{ object_type }}</option>
            {% endfor %}
          </select>
      </div>

      <div class="input-container">
        <label class="select-label" for="alt-id-select">Alternate Identifier</label>
        <input id="alt-id-select" type="text" name="alt_identifier" />
      </div>

      <div class="input-container">
        <label class="select-label" for="collection-select">Collection</label>
        <select id="collection-select" class="select" name="collection_alt_identifier">
          <option value="">Select Collection</option>
          {% for collection_alt_identifier in collection_alt_identifiers %}
          <option value="{{ collection_alt_identifier }}">{{ collection_alt_identifier }}</option>
          {% endfor %}
        </select>
      </div>
      <button type="submit" class="button button--primary">Apply filters</button>
    </div>

    <div class="tag-group">
      {% for filter_label in filter_labels %}
      <a class="tag" href="{{ filter_label.remove_url }}">
        <span>{{ filter_label.title }}</span>
        <svg role="img" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="20px" fill="#212B36">
          <path d="M0 0h24v24H0z" fill="none" />
          <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" />
        </svg>
      </a>
      {% endfor %}
      {% if filter_labels %}
      <button class="button--clear">Clear all active filters</button>
      {% endif %}
    </div>
  </form>

<p>
  Showing {{ page.range }} of {{ page.total_items }} of Intellectual Objects.
</p>
<div class="table-wrapper">
<table class="m-table objects-table">
  <thead>
    <tr>    
      <th scope="col">Title</td>
      <th scope="col">Alternate Identifiers</td>
      <th scope="col">Type</td>
      <th scope="col">Collection</td>
      <th scope="col">Size</td>
      <th scope="col"># Filesets</td>
      <th scope="col">Updated</td>
    </tr>
  </thead>
  <tbody>
    {% for item in page.items %}
    <tr>
      <th scope="row">{{ item.title }}</th>
      <td><a href="{{ item.identifier }}">{{ item.alternate_identifiers }}</a></td>
      <td>{{ item.type }}</td>
      <td>{{ item.collections_summary }}</td>
      <td>{{ item.total_data_size }}</td>
      <td>{{ item.filesets|length }}</td>
      <td>{{ item.updated_at.strftime("%Y-%m-%d %H:%M") }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
<div id="pagination">
  <div id="data" data-url="{{ request.url }}" data-limit="{{ page.limit }}" data-total="{{ page.total_items }}"></div>
  <div class="input-group-inline">
    <div class="input-group-inline" style="float: left">
      <div class="input-container mr-1">
        <button
          id="pagePreviousButton"
          class="button--ghost"
          {% if page.previous_offset == -1 %} disabled {% endif %}
        >
          <span class="material-symbols-rounded">chevron_backward</span>
          <span>Previous</span>
        </button>
      </div>
      <div class="input-container">
        <button
          id="pageNextButton"
          class="button--ghost"
          {% if page.next_offset == -1 %} disabled {% endif %}
        >
          <span>Next</span>
          <span class="material-symbols-rounded">chevron_right</span>
        </button>
      </div>
    </div>
    <div class="input-group-inline" style="float: right">
      <div class="input-container mr-1">
        <span>
          Go to page&nbsp;
          <input
            type="number"
            id="pageNumberInput"
            name="number"
            min="1"
            max="{{ page.total_pages }}"
            value="{{ page.index }}"
            step="1"
          />
          of {{ page.total_pages }}
        </span>
      </div>
      <div class="input-container">
        <button id="pageGoButton" class="button--primary">Go</button>
      </div>
    </div>
  </div>
</div>
<script>
  const dataElem = document.getElementById("data");
  const urlString = dataElem.dataset.url;
  const limit = Number(dataElem.dataset.limit);
  const total = Number(dataElem.dataset.total);

  const url = new URL(urlString);
  const path = url.pathname;
  const searchParams = new URLSearchParams(url.search);
  const currentStart = Number(searchParams.get("start") ?? 0);

  document.getElementById('pagePreviousButton').onclick = function() {
    if (currentStart <= 0) return;
    searchParams.set("start", currentStart - limit > 0 ? currentStart - limit : 0);
    window.location.href = path + "?" + searchParams.toString();
  };

  document.getElementById('pageNextButton').onclick = function() {
    if (currentStart + limit > total) return;
    searchParams.set("start", currentStart + limit);
    window.location.href = path + "?" + searchParams.toString();
  };

  document.getElementById('pageGoButton').onclick = function() {
    const pageNumValue = document.getElementById("pageNumberInput").value;
    const start = limit * (Number(pageNumValue) - 1);
    searchParams.set("start", start)
    window.location.href = path + "?" + searchParams.toString()
  };
</script>

</div>
</div>
</div>
{% endblock %}