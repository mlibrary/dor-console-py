{% from 'macros/pagination.html' import pagination %}
{% extends "base.html" %}

{% block content %}

<div class="back-link">
<span class="material-symbols-rounded">chevron_backward</span>
<a href="../">Back to objects</a>
</div>

<p class="subtle-heading">Object</p>

<h1 class="mb-2">{{ object.title }}</h1>

<div class="object-flex-layout">
<section>
<h2>About this object</h2>
<dl class="object-list">
  <dt>Identifier</dt>
  <dd>{{ object.identifier }}</dd>

  <dt>Alternate identifier</dt>
  <dd>{{ object.alternate_identifiers }}</dd>

  <dt>Description</dt>
  <dd>{{ object.description }}</dd>

  <dt>Date ingested:</dt>
  <dd>{{ object.created_at }}</dd>

  <dt>Total size: </dt>
  <dd>{{ object.total_data_size }}</dd>

  <dt>Number of filesets:</dt>
  <dd>{{ object.filesets|length }}</dd>

  <dt>Number of files:</dt>
  <dd></dd>

  <dt>Type</dt>
  <dd>{{ object.type }}</dd>

  <dt>Revisions</dt>
  <dd>{{ object.revision_number}}</dd>
</dl>

<button class="button button--link">View source metadata</button>
</section>
<section>
<h2>Object event history</h2>
</section>
</div>

<h2>Object descriptor and metadata</h2>
<div class="table-wrapper">
<table class="m-table">
  <thead>
    <tr>
      <th>File name</td>
      <th>Size</td>
      <th>Action</td>
    </tr>
  </thead>
  <tbody>
   <!--Add table loop--> 
    <tr>
      <td class="mono">hereisafakefilename0000.jpg</td>
      <td>1GB</td>
      <td>Download file</td>
    </tr>
  </tbody>
</table>
</div>
<button class="button button--ghost">View metadata files (PREMIS, json)</button>

<h2>Source Files</h2>
<p>A list of the data source files in this object. Select one to view details about the entire fileset associated with it, including service files, descriptor files, and event metadata. </p>
<!--Add the source file loop-->
<div class="mb-1">
<p>Showing {{ filesets_page.range }} of {{ filesets_page.total_items }} filesets</p>
{% for fileset in filesets_page.items %}
<details>
  <summary class="mono">source file name <span class="order-label">{{ fileset.order_label }}</span></summary>
  <div class="details-contents-wrapper">
    <h3>About this fileset</h3>
    <dl>
      <dt>Total size:</dt>
      <dd></dd>
      <dt>Type:</dt>
      <dd></dd>
      <dt>Ingested:</dt>
      <dd></dd>
      <dt>Last fixity:</dt>
      <dd></dd>
    </dl>
    <h3>Fileset contents</h3>
    <div class="table-wrapper">
    <table class="m-table">
      <thead>
        <tr>
          <th>File name</td>
          <th>Size</td>
          <th>Action</td>
        </tr>
      </thead>
      <tbody>
      <!--Add table loop--> 
        <tr>
          <td class="mono">hereisafakefilename0000.jpg</td>
          <td>1GB</td>
          <td>Download file</td>
        </tr>
      </tbody>
    </table>
    <button class="button button--ghost mb-2">View descriptor and metadata files</button>
    </div>
    <button class="button button--secondary">Download fileset</button>
  </div>
</details>
{% endfor %}
</div>
<div
  id="pagination-data"
  data-url="{{ request.url }}"
  data-limit="{{ filesets_page.limit }}"
  data-total="{{ filesets_page.total_items }}"
>
</div>
{{ pagination(
  page_index=filesets_page.index,
  num_pages=filesets_page.total_pages,
  previous_button_id='pagePreviousButton',
  previous_button_disabled=filesets_page.previous_offset == -1,
  next_button_id='pageNextButton',
  next_button_disabled=filesets_page.next_offset == -1,
  page_number_input_id='pageNumberInput',
  go_button_id='pageGoButton'
) }}
<script>
  const dataElem = document.getElementById("pagination-data");
  const urlString = dataElem.dataset.url;
  const limit = Number(dataElem.dataset.limit);
  const total = Number(dataElem.dataset.total);

  const url = new URL(urlString);
  const path = url.pathname;
  const searchParams = new URLSearchParams(url.search);
  const currentStart = Number(searchParams.get("fileset_start") ?? 0);

  document.getElementById('pagePreviousButton').onclick = function() {
    if (currentStart <= 0) return;
    searchParams.set("fileset_start", currentStart - limit > 0 ? currentStart - limit : 0);
    window.location.href = path + "?" + searchParams.toString();
  };

  document.getElementById('pageNextButton').onclick = function() {
    console.log("next click")
    if (currentStart + limit > total) return;
    searchParams.set("fileset_start", currentStart + limit);
    window.location.href = path + "?" + searchParams.toString();
  };

  document.getElementById('pageGoButton').onclick = function() {
    const pageNumValue = document.getElementById("pageNumberInput").value;
    const start = limit * (Number(pageNumValue) - 1);
    searchParams.set("fileset_start", start)
    window.location.href = path + "?" + searchParams.toString()
  };
</script>
<h2>Actions</h2>
<button class="button button--primary">Download object</button>
<button class="button button--delete">Delete object</button>
{% endblock %}
